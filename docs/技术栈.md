# EnglishPod3 Enhanced 技术栈文档

| 文档版本 | V1.1 |
| --- | --- |
| **日期** | 2026-02-05 |
| **状态** | 待审核 |
| **核心理念** | 后端数据库做骨架 + Obsidian 做皮肤 + CLI 做扳机 |

---

## 1. 架构设计原则

### 1.1 核心架构

```
┌─────────────────────────────────────────────────────────────────┐
│                    用户交互层 (CLI + Obsidian)                  │
├─────────────────────────────────────────────────────────────────┤
│  run.py (生产阶段)    │    Obsidian (校对阶段)   │ publish.py │
│  - 终端进度可视化      │  - Markdown 可视化编辑    │ - 数据回填  │
│  - 显式触发            │  - 中英对照表格           │ - 平台分发  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      业务逻辑层 (Python Services)               │
├─────────────────────────────────────────────────────────────────┤
│  DownloadService │ WhisperService │ SegmentationService │       │
│  TranslationService │ MarkdownService │ PublishService   │       │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    数据持久化层 (SQLite + SQLAlchemy)           │
├─────────────────────────────────────────────────────────────────┤
│  episodes │ audio_segments │ transcript_cues │ translations    │
│  chapters │ marketing_posts │ publication_records               │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 设计原则

| 原则 | 说明 | 实现方式 |
| --- | --- | --- |
| **Local-First** | 本地优先，数据完全自主掌控 | SQLite 本地数据库 |
| **去轮询化** | 拒绝后台轮询，显式触发 | CLI 命令行触发机制 |
| **断点续传** | 支持中断恢复，避免重复工作 | 状态机 + 错误记录 + 重试计数 |
| **数据资产化** | 收集 RLHF 训练数据 | Translation 双文本设计 |
| **内容赛马** | 支持多角度营销文案分发 | MarketingPost 1:N 堆叠架构 |

---

## 2. 项目目录结构

### 2.1 完整目录树

```
EnglishPod-knowledgeBase/
│
├── backend/                           # Python 后端
│   ├── app/                           # 应用核心代码
│   │   ├── __init__.py
│   │   ├── main.py                    # FastAPI 主入口
│   │   ├── config.py                  # 配置管理 [从 PodFlow 复用]
│   │   ├── database.py                # 数据库连接管理
│   │   ├── dependencies.py            # FastAPI 依赖注入
│   │   │
│   │   ├── api/                       # API 路由层
│   │   │   ├── __init__.py
│   │   │   ├── episodes.py
│   │   │   ├── transcripts.py
│   │   │   ├── translations.py
│   │   │   ├── chapters.py
│   │   │   ├── marketing.py
│   │   │   └── publications.py
│   │   │
│   │   ├── models/                    # SQLAlchemy 模型
│   │   │   ├── __init__.py
│   │   │   ├── base.py
│   │   │   ├── episode.py
│   │   │   ├── audio_segment.py       # [从 PodFlow 复用结构]
│   │   │   ├── transcript_cue.py      # [从 PodFlow 复用结构]
│   │   │   ├── translation.py         # RLHF 双文本
│   │   │   ├── chapter.py
│   │   │   ├── marketing_post.py
│   │   │   └── publication_record.py
│   │   │
│   │   ├── schemas/                   # Pydantic 模型
│   │   │   ├── __init__.py
│   │   │   ├── episode.py
│   │   │   ├── transcript.py
│   │   │   ├── translation.py
│   │   │   └── chapter.py
│   │   │
│   │   ├── services/                  # 业务逻辑层
│   │   │   ├── __init__.py
│   │   │   ├── download_service.py
│   │   │   ├── transcription_service.py # [从 PodFlow 复用]
│   │   │   ├── segmentation_service.py
│   │   │   ├── translation_service.py
│   │   │   ├── obsidian_service.py
│   │   │   ├── marketing_service.py
│   │   │   │
│   │   │   ├── whisper/               # [从 PodFlow 复用]
│   │   │   │   ├── __init__.py
│   │   │   │   └── whisper_service.py
│   │   │   │
│   │   │   ├── ai/                    # [从 PodFlow 复用结构]
│   │   │   │   ├── __init__.py
│   │   │   │   └── ai_service.py
│   │   │   │
│   │   │   └── publishers/            # 发布平台适配器
│   │   │       ├── __init__.py
│   │   │       ├── base.py
│   │   │       ├── feishu.py
│   │   │       ├── ima.py
│   │   │       └── marketing.py
│   │   │
│   │   ├── utils/                     # 工具函数
│   │   │   ├── __init__.py
│   │   │   ├── file_utils.py          # [从 PodFlow 复用]
│   │   │   ├── time_utils.py
│   │   │   ├── markdown_utils.py
│   │   │   ├── hardware_patch.py      # [从 PodFlow 复用]
│   │   │   └── progress.py
│   │   │
│   │   └── workflows/                 # 工作流编排
│   │       ├── __init__.py
│   │       ├── runner.py              # run.py 逻辑
│   │       ├── publisher.py           # publish.py 逻辑
│   │       └── state_machine.py       # 状态机
│   │
│   ├── tests/                         # 测试目录
│   │   ├── unit/
│   │   ├── integration/
│   │   └── fixtures/
│   │
│   ├── data/                          # 数据目录
│   │   ├── database.db
│   │   ├── audio/
│   │   └── exports/
│   │
│   ├── scripts/                       # 脚本入口
│   │   ├── run.py
│   │   ├── publish.py
│   │   └── init_db.py
│   │
│   ├── requirements.txt
│   ├── .env.example
│   ├── .env
│   └── .gitignore
│
├── obsidian/                          # Obsidian Vault
│   ├── .obsidian/
│   │   ├── plugins/
│   │   ├── themes/
│   │   └── config.json
│   ├── templates/
│   │   ├── episode_template.md
│   │   └── chapter_template.md
│   ├── episodes/                      # 自动生成的 Markdown
│   └── assets/
│
├── docs/                              # 项目文档
│   ├── prd.md
│   ├── database-design.md
│   ├── 技术栈.md
│   ├── 开发配置.md
│   ├── 项目目录设计.md
│   └── 开发计划.md
│
└── README.md
```

### 2.2 目录结构说明

#### 2.2.1 services/ 子目录结构

| 子目录 | 职责 | 来源 |
| --- | --- | --- |
| `services/whisper/` | WhisperX 转录服务 | [从 PodFlow 复用] |
| `services/ai/` | LLM 统一接口 | [从 PodFlow 复用结构] |
| `services/publishers/` | 平台发布适配器 | [新增] |

#### 2.2.2 models/ 拆分设计

| 文件 | 模型 | 说明 |
| --- | --- | --- |
| `models/base.py` | Base | SQLAlchemy 声明基类 |
| `models/episode.py` | Episode | 主表模型 |
| `models/audio_segment.py` | AudioSegment | 虚拟分段 [从 PodFlow 复用] |
| `models/transcript_cue.py` | TranscriptCue | 字幕 [从 PodFlow 复用，扩展] |
| `models/translation.py` | Translation | RLHF 双文本 [新增] |
| `models/chapter.py` | Chapter | 章节切分 [新增] |
| `models/marketing_post.py` | MarketingPost | 营销文案 [新增] |
| `models/publication_record.py` | PublicationRecord | 发布记录 [新增] |

---

## 3. PodFlow 代码复用策略

### 2.1 总体结构

```
EnglishPod-knowledgeBase/
├── backend/                           # Python 后端
│   ├── app/
│   │   ├── api/                       # API 路由层 (HTTP 接口)
│   │   ├── models/                    # SQLAlchemy 模型
│   │   ├── schemas/                   # Pydantic 模型
│   │   ├── services/                  # 业务逻辑层
│   │   │   ├── whisper/               # Whisper 相关 [从 PodFlow 复用]
│   │   │   ├── ai/                    # AI 服务 [从 PodFlow 复用]
│   │   │   └── publishers/            # 发布平台适配器 [新增]
│   │   ├── workflows/                 # 工作流编排 [新增]
│   │   └── utils/                     # 工具函数
│   ├── tests/                         # 测试目录
│   ├── data/                          # 数据目录
│   └── scripts/                       # 脚本入口
├── obsidian/                          # Obsidian Vault (皮肤层)
└── docs/                              # 项目文档
```

### 2.2 PodFlow 代码复用策略

| 原则 | 说明 |
| --- | --- |
| **复制而非引用** | 从 PodFlow 复制代码副本，两个仓库独立维护 |
| **保留核心逻辑** | Whisper 转录、虚拟分段、数据库模型等核心模块直接复用 |
| **扩展新功能** | 在复用基础上扩展语义分析、翻译、Markdown 渲染等功能 |
| **独立演进** | 两个项目后续独立开发，互不影响 |

### 2.3 可复用模块清单

| PodFlow 模块 | 复用程度 | 新项目位置 | 说明 |
| --- | --- | --- | --- |
| **config.py** | 完全复用 | `backend/app/config.py` | 配置管理（需扩展参数） |
| **file_utils.py** | 完全复用 | `backend/app/utils/file_utils.py` | 文件处理工具 |
| **hardware_patch.py** | 完全复用 | `backend/app/utils/hardware_patch.py` | RTX 5070 兼容性补丁 |
| **whisper_service.py** | 完全复用 | `backend/app/services/whisper/whisper_service.py` | WhisperX 转录服务 |
| **transcription_service.py** | 适配复用 | `backend/app/services/transcription_service.py` | 虚拟分段+转录（90%） |
| **ai_service.py** | 扩展复用 | `backend/app/services/ai/ai_service.py` | LLM 统一接口 |

### 2.4 新增模块目录

| 新目录/模块 | 功能 | 依赖 |
| --- | --- | --- |
| **api/** | HTTP 接口层 | FastAPI |
| **services/download_service.py** | yt-dlp 视频下载 | yt-dlp, ffmpeg |
| **services/segmentation_service.py** | AI 语义章节切分 | LLM API |
| **services/translation_service.py** | 逐句翻译（断点续传） | LLM API |
| **services/obsidian_service.py** | Obsidian Markdown 生成/解析 | python-frontmatter |
| **services/marketing_service.py** | 营销文案生成 | LLM API |
| **services/publishers/** | 平台分发适配器 | lark-oapi |
| **workflows/** | 工作流编排（runner/publisher） | Rich, Typer |

### 2.5 数据库模型对比

| 表名 | PodFlow | EnglishPod3 | 变更说明 |
| --- | --- | --- | --- |
| **episodes** | ✅ 存在 | ✅ 扩展 | 新增 workflow_status, ai_summary 字段 |
| **audio_segments** | ✅ 存在 | ✅ 复用 | 无变更 |
| **transcript_cues** | ✅ 存在 | ✅ 扩展 | 新增 chapter_id 字段，obsidian_anchor 属性 |
| **translations** | ❌ 不存在 | ✅ 新增 | RLHF 双文本设计 |
| **chapters** | ❌ 不存在 | ✅ 新增 | AI 语义章节切分 |
| **marketing_posts** | ❌ 不存在 | ✅ 新增 | 营销文案多角度分发 |
| **publication_records** | ❌ 不存在 | ✅ 新增 | 平台分发记录 |

### 2.6 模型文件拆分（新设计）

| 旧方式（PodFlow） | 新方式（EnglishPod3） | 说明 |
| --- | --- | --- |
| `models.py`（单文件） | `models/`（目录） | 按表拆分，便于维护 |
| `models.py` | `models/episode.py` | Episode 模型 |
| `models.py` | `models/audio_segment.py` | AudioSegment 模型 |
| `models.py` | `models/transcript_cue.py` | TranscriptCue 模型 |
| `models.py` | `models/translation.py` | Translation 模型 |
| `models.py` | `models/chapter.py` | Chapter 模型 |
| `models.py` | `models/marketing_post.py` | MarketingPost 模型 |
| `models.py` | `models/publication_record.py` | PublicationRecord 模型 |

### 2.7 复用模块详细说明

#### 2.7.1 WhisperService（完全复用）

```python
# 复用位置: backend/app/services/whisper/whisper_service.py
# 核心功能:
# - 单例模式，模型常驻显存
# - 对齐模型缓存机制
# - Diarization 按需加载/释放
# - FFmpeg 音频片段提取
# - RTX 5070 兼容性支持
```

#### 2.7.2 TranscriptionService（适配复用）

```python
# 复用位置: backend/app/services/transcription_service.py
# 核心功能（90%复用）:
# - 虚拟分段创建（基于 SEGMENT_DURATION）
# - 分段转录流程（支持中断恢复）
# - 绝对时间计算（start_time = segment.start_time + cue['start']）
# - Episode 状态同步（需适配新的 workflow_status）
```

#### 2.7.3 AIService（扩展复用）

```python
# 复用位置: backend/app/services/ai/ai_service.py
#
# 原有功能（复制保留）:
# - OpenAI 兼容接口调用（Moonshot/Kimi/DeepSeek/GPT-4 等）
# - Gemini 原生接口调用
# - Mock 模式支持（调试用）
# - 统一配置管理（通过 .env 配置）
#
# 新增功能（在副本上扩展）:
# - batch_translate_cues() 批量翻译
# - segment_chapters() 语义章节切分
# - generate_marketing_posts() 营销文案生成
#
# 所有 AI 功能使用同一套 API 配置（与 PodFlow 统一）
# 默认: kimi-k2-0905-preview (Moonshot API)
```

#### 2.7.4 HardwarePatch（完全复用）

```python
# 复用位置: backend/app/utils/hardware_patch.py
# 核心功能:
# - Omegaconf 白名单
# - weights_only=False 强制设置
# - torchaudio AudioMetaData 补丁
# - list_audio_backends/get_audio_backend Mock
```

---

## 3. 编程语言与运行环境

### 3.1 Python

| 项目 | 说明 |
| --- | --- |
| **版本** | Python 3.8+ |
| **作用** | 核心逻辑语言，串联所有智能功能 |
| **选择理由** | AI 生态绝对统治力，丰富的库支持 |

### 3.2 虚拟环境

| 工具 | 版本 | 说明 |
| --- | --- | --- |
| **venv** | 内置 | Python 原生虚拟环境 |
| **路径** | `backend/venv/` | 隔离项目依赖 |

---

## 4. CLI 框架与终端 UI

### 4.1 Rich - 终端 UI 库

| 项目 | 说明 |
| --- | --- |
| **作用** | 结构化面板展示，提供实时进度反馈 |
| **核心功能** | - 总体进度条 <br> - 当前阶段显示 <br> - 资源监控 <br> - 断点提示高亮 |

**示例输出**:
```
┌─────────────────────────────────────────────────────┐
│  EnglishPod3 Enhanced - 任务控制台                  │
├─────────────────────────────────────────────────────┤
│  总体进度: [████████████░░░░░░░] 60%               │
│  当前阶段: Step 3/5 - Semantic Segmentation        │
│                                                     │
│  资源监控:                                          │
│    Download Speed: 12MB/s                          │
│    Whisper VRAM: 4.2GB                             │
│                                                     │
│  断点提示:                                          │
│  ⚠️  检测到历史任务 [ID: 1024]                     │
│     跳过下载与识别，直接从 [语义切分] 阶段恢复...  │
└─────────────────────────────────────────────────────┘
```

### 3.2 Typer - CLI 框架（可选）

| 项目 | 说明 |
| --- | --- |
| **作用** | 构建优雅的命令行接口，自动生成帮助文档 |
| **核心命令** | - `run.py --url <URL>` <br> - `publish.py --id <ID>` |

**示例命令**:
```bash
# 生产阶段
python run.py --url https://youtube.com/watch?v=xyz

# 发布阶段
python publish.py --id 1024 --platform feishu,ima

# 查看状态
python status.py --id 1024
```

---

## 5. Web 框架

### 5.1 FastAPI

| 项目 | 说明 |
| --- | --- |
| **作用** | 高性能 Web 框架，定义 HTTP 接口 |
| **选择理由** | - 异步支持 <br> - 自动生成 Swagger 文档 <br> - 类型验证（Pydantic） |
| **使用场景** | - 本地调试 API <br> - 未来可扩展 Web UI |

---

## 6. 数据库 ORM

### 6.1 SQLAlchemy 2.0+

| 项目 | 说明 |
| --- | --- |
| **作用** | 数据库 ORM，提供 Python 对象映射 |
| **选择理由** | - 成熟稳定 <br> - 支持异步 <br> - 强大的关系映射 |
| **数据库** | SQLite（本地文件数据库） |

---

## 7. AI 能力层

### 7.1 WhisperX - 语音识别

| 项目 | 说明 |
| --- | --- |
| **作用** | 离线语音识别，生成带时间戳的英文字幕 |
| **选择理由** | - 支持说话人区分（Diarization） <br> - 零 API 成本 <br> - 数据隐私 |
| **模型** | large-v3（推荐） |

### 7.2 LLM API - 语义分析与翻译

> **复用 PodFlow AI 配置**：与 PodFlow 项目使用同一套 API 配置，通过 `.env` 统一管理。

| 服务类型 | 默认模型 | 说明 |
| --- | --- | --- |
| **Moonshot API** | kimi-k2-0905-preview | 默认选择（与 PodFlow 一致） |
| **OpenAI 兼容** | GPT-4o / GPT-4o-mini | 可选配置 |
| **Gemini 原生** | Gemini 2.0 Flash | 可选配置 |
| **DeepSeek** | DeepSeek-V3 | 可选配置 |

**API 调用策略**（统一配置）:
- **语义章节切分**: 使用配置的默认模型（kimi-k2-0905-preview）
- **逐句翻译**: 使用配置的默认模型（支持批量处理）
- **营销文案生成**: 使用配置的默认模型（多角度生成）

**配置示例**（`.env`）:
```bash
# AI 提供商类型: openai (兼容) 或 gemini (原生)
AI_PROVIDER_TYPE=openai

# AI 模型名称（与 PodFlow 统一）
AI_MODEL_NAME=kimi-k2-0905-preview

# API 配置
AI_API_KEY=sk-xxx
AI_BASE_URL=https://api.moonshot.cn/v1
```

---

## 8. 音频/视频处理

### 8.1 yt-dlp

| 项目 | 说明 |
| --- | --- |
| **作用** | 视频/音频下载工具 |
| **支持平台** | YouTube, Bilibili, 播客 RSS 等 |
| **选择理由** | - 活跃维护 <br> - 广泛平台支持 |

### 8.2 FFmpeg

| 项目 | 说明 |
| --- | --- |
| **作用** | 多媒体处理引擎 |
| **核心功能** | - 音频格式转换 <br> - 音频分段提取 <br> - 元数据提取 |

---

## 9. Markdown 处理

### 9.1 python-frontmatter

| 项目 | 说明 |
| --- | --- |
| **作用** | 解析/生成 Markdown YAML 头部 |
| **使用场景** | Obsidian 文档元数据管理 |

### 9.2 markdown-it-py（可选）

| 项目 | 说明 |
| --- | --- |
| **作用** | Markdown 解析与渲染 |
| **使用场景** | 数据回填时解析 Markdown 表格 |

**Obsidian 隐形锚点格式**:
```markdown
| 时间轴 | 英文原文 | 中文翻译 |
| :--- | :--- | :--- |
| [00:05](cue://1024) | Hello world. | 你好世界。 |
```

---

## 10. 平台分发 API

### 10.1 飞书 Open API

| 项目 | 说明 |
| --- | --- |
| **SDK** | `lark-oapi` |
| **功能** | - 创建多维表格记录 <br> - 创建云文档 <br> - 发送消息通知 |

### 10.2 腾讯 IMA（知识库）

| 项目 | 说明 |
| --- | --- |
| **SDK** | 待定（根据官方文档） |
| **功能** | 上传知识条目 |

---

## 11. 配置管理

### 11.1 python-dotenv

| 项目 | 说明 |
| --- | --- |
| **作用** | 环境变量管理 |
| **配置文件** | `.env` |

**`.env` 示例**（与 PodFlow 统一）:
```bash
# ==================== 数据库配置 ====================
DATABASE_URL=sqlite:///./data/episodes.db

# ==================== AI 服务配置（与 PodFlow 统一）====================
# AI 提供商类型: 'openai' (兼容接口) 或 'gemini' (原生接口)
AI_PROVIDER_TYPE=openai

# AI 模型名称（默认使用 Moonshot Kimi）
AI_MODEL_NAME=kimi-k2-0905-preview

# AI API Key
AI_API_KEY=sk-xxx

# AI Base URL（Moonshot API）
AI_BASE_URL=https://api.moonshot.cn/v1

# AI 查询超时时间（秒）
AI_QUERY_TIMEOUT=60

# AI Mock 模式（调试用，不消耗 Token）
USE_AI_MOCK=false

# ==================== Whisper 配置 ====================
HF_TOKEN=hf_xxx  # HuggingFace Token（说话人区分必需）
WHISPER_MODEL=large-v3
WHISPER_DEVICE=cuda

# ==================== 飞书配置 ====================
FEISHU_APP_ID=cli_xxx
FEISHU_APP_SECRET=xxx

# ==================== Obsidian 配置 ====================
# Obsidian Vault 路径（项目根目录下的 obsidian/ 文件夹）
OBSIDIAN_VAULT_PATH=D:/programming_enviroment/EnglishPod-knowledgeBase/obsidian
```

---

## 12. 测试框架

### 12.1 Pytest

| 项目 | 说明 |
| --- | --- |
| **作用** | 单元测试框架 |
| **测试目录** | `backend/tests/` |
| **命名规范** | `test_*.py` |

### 12.2 pytest-asyncio

| 项目 | 说明 |
| --- | --- |
| **作用** | 异步测试支持 |

### 12.3 pytest-cov

| 项目 | 说明 |
| --- | --- |
| **作用** | 代码覆盖率统计 |

---

## 13. 日志与监控

### 13.1 Loguru

| 项目 | 说明 |
| --- | --- |
| **作用** | 日志库，替代标准 logging |
| **选择理由** | - 更简洁的 API <br> - 自动日志轮转 <br> - 彩色输出 |

**日志配置示例**:
```python
from loguru import logger

logger.add(
    "logs/app_{time}.log",
    rotation="1 day",
    retention="30 days",
    level="INFO"
)
```

### 13.2 Rich 集成

| 项目 | 说明 |
| --- | --- |
| **作用** | 终端日志美化 |
| **功能** | - 进度条 <br> - 表格展示 <br> - 状态面板 |

---

## 14. 异步任务队列（可选扩展）

### 14.1 asyncio

| 项目 | 说明 |
| --- | --- |
| **作用** | Python 原生异步库 |
| **使用场景** | - 并发 LLM API 调用 <br> - 批量转录处理 |

### 14.2 Celery + Redis（未来扩展）

| 项目 | 说明 |
| --- | --- |
| **作用** | 分布式任务队列 |
| **使用场景** | 多机并行处理大量任务 |

---

## 15. 硬件兼容性说明

### 15.1 RTX 5070 专用补丁

| 项目 | 说明 |
| --- | --- |
| **适用范围** | RTX 5070 显卡 + PyTorch Nightly |
| **问题原因** | CUDA 13.0+ 兼容性问题 |
| **解决方案** | Monkey Patch 方式修复 API |

**补丁模块**: `app/utils/hardware_patch.py`

---

## 16. 开发工具

### 16.1 代码格式化

| 工具 | 说明 |
| --- | --- |
| **Black** | Python 代码格式化 |
| **isort** | import 排序 |

### 16.2 代码检查

| 工具 | 说明 |
| --- | --- |
| **Pylint** | 代码质量检查 |
| **mypy** | 类型检查 |

---

## 17. 项目目录结构总览

### 17.1 目录分层架构

```
┌─────────────────────────────────────────────────────────────┐
│                      用户交互层                               │
├─────────────────────────────────────────────────────────────┤
│  CLI (scripts/)    │  Obsidian (obsidian/)                   │
│  - run.py          │  - episodes/{episode_id}_{title}.md    │
│  - publish.py      │  - templates/                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      应用层 (app/)                           │
├─────────────────────────────────────────────────────────────┤
│  api/ (HTTP)  │  services/ (业务逻辑)  │  models/ (数据)    │
│  workflows/ (编排)  │  utils/ (工具)                         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      数据层                                  │
├─────────────────────────────────────────────────────────────┤
│  SQLite (data/)  │  Obsidian Vault  │  Audio Files          │
└─────────────────────────────────────────────────────────────┘
```

### 17.2 技术栈总览表

| 层级 | 技术 | 版本要求 | 用途 |
| --- | --- | --- | --- |
| **语言** | Python | 3.8+ | 核心开发语言 |
| **CLI** | Rich | Latest | 终端 UI |
| **CLI** | Typer | Latest | 命令行框架 |
| **Web** | FastAPI | 0.100+ | API 框架 |
| **数据库** | SQLite | 3.x | 本地数据库 |
| **ORM** | SQLAlchemy | 2.0+ | 数据库映射 |
| **语音识别** | WhisperX | Latest | 离线转录 |
| **LLM** | OpenAI API | GPT-4o | AI 能力 |
| **下载** | yt-dlp | Latest | 视频下载 |
| **音视频** | FFmpeg | 5.x+ | 媒体处理 |
| **Markdown** | python-frontmatter | Latest | Markdown 处理 |
| **飞书** | lark-oapi | Latest | 飞书集成 |
| **配置** | python-dotenv | Latest | 环境变量 |
| **测试** | pytest | 7.x+ | 单元测试 |
| **日志** | Loguru | Latest | 日志管理 |

---

## 18. 技术选型对比

### 18.1 CLI 框架对比

| 框架 | 优势 | 劣势 | 选择 |
| --- | --- | --- | --- |
| **Rich + Click** | 功能强大，灵活 | 配置较复杂 | 备选 |
| **Rich + Typer** | 自动帮助文档，类型提示 | 功能相对简单 | **推荐** |
| **Rich + argparse** | 标准库，无依赖 | 手动配置，繁琐 | 不推荐 |

### 18.2 LLM API 对比

| 服务 | 模型 | 成本 | 质量 | 选择 |
| --- | --- | --- | --- | --- |
| **OpenAI** | GPT-4o | 中 | 高 | **推荐** |
| **Claude** | Claude 3.5 Sonnet | 中 | 高 | 备选 |
| **DeepSeek** | DeepSeek-V3 | 低 | 中 | 备选 |
| **本地模型** | Qwen2.5 72B | 零 | 中 | 未来扩展 |

---

## 19. 依赖清单

### 19.1 核心依赖（requirements.txt）

```txt
# ==================== Web 框架 ====================
fastapi>=0.100.0
uvicorn[standard]>=0.23.0
pydantic>=2.0.0

# ==================== 数据库 ====================
sqlalchemy>=2.0.0

# ==================== AI 能力 ====================
openai>=1.0.0
google-generativeai>=0.3.0
whisperx>=3.1.0
psutil>=5.9.0

# ==================== 音视频处理 ====================
yt-dlp>=2023.10.0
ffmpeg-python>=0.2.0

# ==================== CLI 与终端 UI ====================
rich>=13.7.0
typer>=0.9.0

# ==================== Markdown 处理 ====================
python-frontmatter>=1.0.0
markdown-it-py>=3.0.0

# ==================== 平台集成 ====================
lark-oapi>=1.2.0

# ==================== 配置与日志 ====================
python-dotenv>=1.0.0
loguru>=0.7.0

# ==================== 测试 ====================
pytest>=7.4.0
pytest-asyncio>=0.21.0
pytest-cov>=4.1.0

# ==================== 开发工具 ====================
black>=23.0.0
isort>=5.12.0
pylint>=3.0.0
mypy>=1.6.0
```

### 19.2 硬件依赖

| 硬件 | 最低要求 | 推荐配置 |
| --- | --- | --- |
| **CPU** | 4 核 | 8 核+ |
| **内存** | 16GB | 32GB+ |
| **GPU** | 无 | NVIDIA RTX 4070+ (推荐 5070) |
| **显存** | 无 | 12GB+ VRAM |
| **存储** | 50GB SSD | 200GB+ NVMe SSD |

---

## 20. 技术债务与未来扩展

### 20.1 短期优化（V1.5）

| 优化项 | 说明 | 优先级 |
| --- | --- | --- |
| **异步并发** | LLM API 批量调用优化 | 高 |
| **缓存机制** | 翻译结果缓存 | 中 |
| **增量处理** | 支持视频部分章节处理 | 中 |

### 20.2 中期扩展（V2.0）

| 扩展项 | 说明 | 优先级 |
| --- | --- | --- |
| **本地 LLM** | 集成 Ollama/LM Studio | 高 |
| **多语言支持** | 扩展日语、韩语翻译 | 中 |
| **Web UI** | 可选的 Web 界面 | 中 |

### 20.3 长期规划（V3.0）

| 扩展项 | 说明 | 优先级 |
| --- | --- | --- |
| **分布式处理** | Celery + Redis 多机并行 | 低 |
| **RLHF 训练** | 导出微调数据集 | 低 |
| **移动端** | iOS/Android 应用 | 低 |

---

## 21. 安全性考虑

### 21.1 API Key 管理

| 措施 | 说明 |
| --- | --- |
| **环境变量** | 所有敏感信息存入 `.env` |
| **`.gitignore`** | 确保 `.env` 不被提交 |
| **权限控制** | `.env` 文件设置为仅所有者可读 |

### 21.2 数据安全

| 措施 | 说明 |
| --- | --- |
| **本地存储** | 所有数据存储在本地 |
| **加密传输** | HTTPS 调用 API |
| **定期备份** | SQLite 数据库定期备份 |

---

**文档结束** | 请审核后反馈修改意见
