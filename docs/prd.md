è¿™ä»½æ–‡æ¡£æ˜¯ä¸ºä½ é‡èº«å®šåˆ¶çš„æœ€ç»ˆç‰ˆ PRDã€‚å®ƒä¸¥æ ¼æ•´åˆäº†**ç”¨æˆ·æŒæ§æ„Ÿï¼ˆç»ˆç«¯å¯è§†åŒ–ï¼‰ã€æ•°æ®åº“æ–­ç‚¹ç»­ä¼ ã€å»è½®è¯¢åŒ–ï¼ˆCLI è§¦å‘ï¼‰ã€Obsidian å¯è§†åŒ–äº¤äº’ã€ä»¥åŠé˜²æ¼‚ç§»çš„ä¸­è‹±å¯¹ç…§/æ€»åˆ†ç»“æ„**ç­‰æ‰€æœ‰æ ¸å¿ƒéœ€æ±‚ã€‚

---

# äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)ï¼šè‹±è¯­å­¦ä¹ å†…å®¹è‡ªåŠ¨åŒ–å·¥ä½œæµ (EnglishPod3 Enhanced)

| æ–‡æ¡£ç‰ˆæœ¬ | V3.1 (Final Release) |
| --- | --- |
| **çŠ¶æ€** | å·²å®šç¨¿ / å¾…å¼€å‘ |
| **æ ¸å¿ƒç†å¿µ** | **åç«¯æ•°æ®åº“åšéª¨æ¶ (Podflowå¤ç”¨) + Obsidian åšçš®è‚¤ (äº¤äº’ç•Œé¢) + CLI åšæ‰³æœº (æ˜¾å¼è§¦å‘)** |
| **ç›®æ ‡ç”¨æˆ·** | æå®¢å‹è‹±è¯­å­¦ä¹ è€…ã€å†…å®¹åˆ›ä½œè€… |

---

## 1. æ€»ä½“ä¸šåŠ¡æµç¨‹ (User Flow)

ç³»ç»Ÿæ‘’å¼ƒåå°è‡ªåŠ¨è½®è¯¢ï¼Œé‡‡ç”¨**â€œåŒæŒ‡ä»¤è§¦å‘â€**æœºåˆ¶ï¼Œç¡®ä¿ç”¨æˆ·å¯¹æµç¨‹çš„ç»å¯¹æ§åˆ¶ã€‚

1. **ç”Ÿäº§é˜¶æ®µ (`run.py`):** ç”¨æˆ·è¾“å…¥ URL -> ç»ˆç«¯æ˜¾ç¤ºå®æ—¶è¿›åº¦ -> æ•°æ®åº“è®°å½•æ–­ç‚¹ -> ç”Ÿæˆ Obsidian è°ƒè¯•æ–‡æ¡£ã€‚
2. **æ ¡å¯¹é˜¶æ®µ (Obsidian):** ç”¨æˆ·åœ¨ Obsidian ä¸­é˜…è¯»ä¸­è‹±å¯¹ç…§æ–‡æ¡£ -> ä¿®æ”¹ç¿»è¯‘/æ‘˜è¦ -> æ‰‹åŠ¨æ ‡è®° `reviewed: true`ã€‚
3. **å‘å¸ƒé˜¶æ®µ (`publish.py`):** ç”¨æˆ·ç¡®è®¤æ— è¯¯ -> è¾“å…¥æŒ‡ä»¤ -> è„šæœ¬å›å¡«æ•°æ®åº“ -> åˆ†å‘è‡³é£ä¹¦/IMA/è¥é”€ç«¯ã€‚
4. æ³¨æ„å°½é‡å»å¤ç”¨podflowçš„ä»£ç ï¼Œæˆ‘è¯´çš„å¤ç”¨æ˜¯æŒ‡å¤åˆ¶ä¸€ä»½ï¼Œå› ä¸ºæˆ‘ä¼šåˆ†å¼€ä¸¤ä¸ªä»“åº“åœ¨gitä¸Šé¢æäº¤ã€‚

---

## 2. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—è¯¦è§£

### 2.1 ä»»åŠ¡æ§åˆ¶å°ä¸è¿›åº¦åé¦ˆ (User Control Center)

**éœ€æ±‚ç›®æ ‡ï¼š** æ¶ˆé™¤é»‘ç›’ç„¦è™‘ï¼Œæä¾›æå¼ºçš„æŒæ§æ„Ÿã€‚

* **äº¤äº’æ–¹å¼ï¼š** å‘½ä»¤è¡Œæ¥å£ (CLI)ã€‚
* **å®æ—¶çœ‹æ¿ (Rich Terminal UI)ï¼š**
* è„šæœ¬è¿è¡Œæ—¶ï¼Œå¿…é¡»å±•ç¤ºç»“æ„åŒ–é¢æ¿ï¼ˆå»ºè®®ä½¿ç”¨ `rich` åº“ï¼‰ã€‚
* **åŒ…å«è¦ç´ ï¼š**
* **æ€»ä½“è¿›åº¦æ¡ï¼š** `[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 80%`
* **å½“å‰é˜¶æ®µï¼š** `Step 3/5: Semantic Segmentation (Analyzed 15/20 mins)`
* **èµ„æºç›‘æ§ï¼š** `Download Speed: 12MB/s` | `Whisper VRAM: 4.2GB`




* **æ–­ç‚¹æç¤ºï¼š**
* å¯åŠ¨æ—¶è‹¥æ£€æµ‹åˆ°è¯¥ URL åœ¨æ•°æ®åº“ä¸­å·²æœ‰ä¸­é—´çŠ¶æ€ï¼ˆå¦‚ `TRANSCRIBED`ï¼‰ï¼ŒTerminal è¾“å‡ºé«˜äº®æç¤ºï¼š
> `âš ï¸ æ£€æµ‹åˆ°å†å²ä»»åŠ¡ [ID: 1024]ï¼Œè·³è¿‡ä¸‹è½½ä¸è¯†åˆ«ï¼Œç›´æ¥ä» [è¯­ä¹‰åˆ‡åˆ†] é˜¶æ®µæ¢å¤...`





### 2.2 åŸºç¡€è®¾æ–½å¤ç”¨ä¸çŠ¶æ€æœº (State Machine)

**éœ€æ±‚ç›®æ ‡ï¼š** å¤ç”¨ Podflow æ•°æ®åº“è®¾è®¡ï¼Œå®ç°ä¸¥å¯†çš„æ–­ç‚¹ç»­ä¼ ã€‚

* **æ•°æ®åº“å¤ç”¨ (`episodes` / `transcripts` è¡¨)ï¼š**
* æ–°å¢/æ‰©å±•çŠ¶æ€å­—æ®µ `status` (Integer)ï¼š
* `0: INIT` (å·²å…¥åº“)
* `1: DOWNLOADED` (æœ¬åœ°æ–‡ä»¶å°±ç»ª)
* `2: TRANSCRIBED` (WhisperX è‹±æ–‡åŸæ–‡å°±ç»ª)
* `3: SEGMENTED` (ç« èŠ‚åˆ‡åˆ† JSON å°±ç»ª)
* `4: TRANSLATED` (é€å¥ç¿»è¯‘å°±ç»ª)
* `5: READY_FOR_REVIEW` (Obsidian æ–‡æ¡£å·²ç”Ÿæˆ)
* `6: PUBLISHED` (å·²åˆ†å‘)




* **ç»­ä¼ é€»è¾‘ï¼š**
* è„šæœ¬å¯åŠ¨ -> æŸ¥è¯¢ DB -> è·å–å½“å‰ `status` -> æ‰§è¡Œ `status + 1` çš„å¯¹åº”çš„å‡½æ•°ã€‚
* **å¼‚å¸¸ä¿æŠ¤ï¼š** ä»»ä½• API æŠ¥é”™æˆ–ç½‘ç»œä¸­æ–­ï¼Œè„šæœ¬ç«‹å³åœæ­¢å¹¶ä¿å­˜å½“å‰è¿›åº¦åˆ° DBï¼Œç»ä¸å›æ»šã€‚



### 2.3 è¯­ä¹‰åˆ†æä¸é˜²æ¼‚ç§»å¼•æ“ (Semantic Engine)

**éœ€æ±‚ç›®æ ‡ï¼š** è§£å†³â€œä¸­æ–‡ç¿»è¯‘å¯¼è‡´é€»è¾‘ä¸¢å¤±â€çš„é—®é¢˜ï¼Œå®ç°ç²¾å‡†çš„ç« èŠ‚åˆ’åˆ†ã€‚

* **å¤„ç†é€»è¾‘ï¼š** **è‹±æ–‡è¾“å…¥ -> é€»è¾‘åˆ†æ -> ä¸­æ–‡è¾“å‡º**ã€‚
* **Prompt ç­–ç•¥ï¼š**
* **Input:** å®Œæ•´çš„è‹±æ–‡ Transcriptï¼ˆå«æ—¶é—´æˆ³ï¼‰ã€‚
* **Instruction:** "åˆ†æè‹±æ–‡åŸæ–‡çš„è¯­ä¹‰è½¬æŠ˜ç‚¹ï¼Œè¿›è¡Œç« èŠ‚åˆ’åˆ†ã€‚ç›´æ¥è¾“å‡º**ä¸­æ–‡**çš„ç« èŠ‚æ ‡é¢˜å’Œç« èŠ‚æ‘˜è¦ã€‚"
* **Output:** æ ‡å‡† JSON æ ¼å¼ï¼ˆç”¨äºåç»­ Markdown æ¸²æŸ“ï¼‰ã€‚



### 2.4 ä¸­è‹±é€å¥å¯¹ç…§ä¸æ ¡å¯¹ (Bilingual Processing)

**éœ€æ±‚ç›®æ ‡ï¼š** æä¾›ç²¾è¯»è¯­æ–™ï¼Œä¸”èŠ‚çœ Tokenã€‚

* **ç¿»è¯‘æœºåˆ¶ï¼š** è°ƒç”¨ LLM API è¿›è¡Œé€å¥ç¿»è¯‘ï¼Œä¿æŒ `Timeline | English | Chinese` çš„å¯¹åº”å…³ç³»ã€‚
* **Token ä¼˜åŒ– (Patch Mode)ï¼š**
* æ ¡å¯¹é˜¶æ®µä¸é‡å†™å…¨æ–‡ã€‚
* AI ä»…è¿”å› `{"id": 105, "fix": "ä¿®æ­£åçš„ä¸“æœ‰åè¯"}`ã€‚
* Python è„šæœ¬åœ¨æœ¬åœ°æ•°æ®åº“æ‰§è¡Œ `UPDATE` æ“ä½œã€‚



---

## 3. äº§å‡ºç‰©å®šä¹‰ï¼šObsidian äº¤äº’ç•Œé¢

ç³»ç»Ÿåœ¨ Obsidian ä¸­ç”Ÿæˆçš„ `.md` æ–‡ä»¶ä¸ä»…æ˜¯ç»“æœï¼Œæ›´æ˜¯**UI (ç”¨æˆ·ç•Œé¢)**ã€‚

### 3.1 è°ƒè¯•æ–‡æ¡£ç»“æ„ (æ€»-åˆ†-ç»†)

æ–‡æ¡£éœ€ä¸¥æ ¼éµå¾ª Markdown æ ¼å¼ï¼Œç»“æ„å¦‚ä¸‹ï¼š

#### A. å¤´éƒ¨ï¼šæ§åˆ¶ä¸ç´¢å¼• (Total)

```markdown
---
task_id: 1024
url: https://youtube.com/watch?v=xyz
status: pending_review  # ç”¨æˆ·æ”¹ä¸º 'reviewed' å³å¯è§¦å‘å‘å¸ƒå‡†å¤‡
---

# [H1] è§†é¢‘æ ‡é¢˜
> **å…¨æ–‡æ¦‚è§ˆï¼š** [AI ç”Ÿæˆçš„ 200 å­—ä¸­æ–‡å…¨ç¯‡æ€»ç»“]

## ğŸ“‘ ç« èŠ‚å¯¼èˆª
| ç« èŠ‚ | æ—¶é—´ | æ ¸å¿ƒè¦ç‚¹ (Summary) |
| :--- | :--- | :--- |
| 1. å¼€åœº | 00:00 | [æœ¬ç« ä¸­æ–‡å°ç»“] |
| 2. æ ¸å¿ƒ | 05:20 | [æœ¬ç« ä¸­æ–‡å°ç»“] |

```

#### B. ä¸»ä½“ï¼šç« èŠ‚åŒ–ä¸­è‹±å¯¹ç…§ (Sub & Detail)

```markdown
## ç¬¬ 1 ç« ï¼š[ä¸­æ–‡ç« èŠ‚æ ‡é¢˜]
> ğŸ’¡ **ç« èŠ‚å¯¼è¯»ï¼š** [æœ¬ç« è¯¦ç»†æ‘˜è¦]

| æ—¶é—´è½´ | è‹±æ–‡åŸæ–‡ | ä¸­æ–‡ç¿»è¯‘ |
| :--- | :--- | :--- |
| 00:01 | Hello world. | ä½ å¥½ä¸–ç•Œã€‚ |
| 00:05 | ... | ... |

```

#### C. å°¾éƒ¨ï¼šè¡ç”Ÿå†…å®¹

* **å…¨ä¸­æ–‡çº¯äº«ç‰ˆï¼š** è„šæœ¬è‡ªåŠ¨å°†ç¿»è¯‘åˆ—æ‹¼æ¥æˆé€šé¡ºçš„æ®µè½ï¼ŒæŒ‰ç« èŠ‚æ’åˆ—ã€‚
* **è¥é”€æ–‡æ¡ˆç”Ÿæˆï¼š**
* å°çº¢ä¹¦æ ‡é¢˜ x 5
* æ­£æ–‡å†…å®¹ (å« Emoji å’Œ Tags)



### 3.2 åŠ¨æ€å ä½ (Placeholder)

åœ¨ `run.py` è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè„šæœ¬ä¼šæå‰åˆ›å»º Obsidian æ–‡ä»¶ï¼Œå†…å®¹æ˜¾ç¤ºä¸ºï¼š

> â³ **ä»»åŠ¡å¤„ç†ä¸­... [è¿›åº¦ 45%]**
> å½“å‰é˜¶æ®µï¼š**AI è¯­ä¹‰åˆ‡åˆ†**
> *è¯·ç¨å€™ï¼Œå®Œæˆåé¡µé¢å°†è‡ªåŠ¨åˆ·æ–°ã€‚*

---

## 4. å‘å¸ƒä¸åˆ†å‘æœºåˆ¶ (Explicit Trigger)

**åŸåˆ™ï¼šæ‹’ç»åå°è½®è¯¢ï¼Œç”¨æˆ·ç¡®è®¤åæ‰‹åŠ¨è§¦å‘ã€‚**

### åŠ¨ä½œæµï¼š

1. **ç”¨æˆ·æ“ä½œï¼š** åœ¨ Obsidian é‡Œä¿®æ­£äº† 3 ä¸ªç¿»è¯‘é”™è¯¯ï¼Œä¿®æ”¹æ–‡æ¡£å±æ€§ä¸º `status: reviewed`ï¼Œä¿å­˜å…³é—­ã€‚
2. **æŒ‡ä»¤è§¦å‘ï¼š** ç”¨æˆ·åœ¨ç»ˆç«¯è¾“å…¥ `python publish.py --id 1024`ã€‚
3. **ç³»ç»Ÿæ‰§è¡Œï¼š**
* **è¯»å– (Read):** è§£æ Markdown è¡¨æ ¼ï¼Œæå–ç”¨æˆ·ä¿®æ”¹åçš„ä¸­æ–‡æ–‡æœ¬ã€‚
* **å›å¡« (Write Back):** æ›´æ–° SQLite æ•°æ®åº“ä¸­çš„ `transcripts` è¡¨ã€‚
* **åˆ†å‘ (Distribute):**
* **é£ä¹¦ï¼š** è°ƒç”¨ OpenAPI åˆ›å»ºå¤šç»´è¡¨æ ¼è®°å½•æˆ–äº‘æ–‡æ¡£ã€‚
* **è…¾è®¯ IMAï¼š** ä¸Šä¼ ä¸ºçŸ¥è¯†æ¡ç›®ã€‚





---

## 5. å¼‚å¸¸å¤„ç†ä¸éåŠŸèƒ½éœ€æ±‚

* **ç½‘ç»œå¼‚å¸¸ï¼š** ä¸‹è½½æˆ– API è¶…æ—¶ï¼Œè‡ªåŠ¨é‡è¯• 3 æ¬¡ï¼ˆæŒ‡æ•°é€€é¿ï¼‰ã€‚è‹¥å¤±è´¥ï¼ŒTerminal æŠ¥é”™å¹¶ä¿å­˜æ–­ç‚¹ã€‚
* **æ ¼å¼å®¹é”™ï¼š** `publish.py` è§£æ Markdown æ—¶ï¼Œè‹¥å‘ç°è¡¨æ ¼åˆ—æ•°ä¸å¯¹ï¼ˆç”¨æˆ·è¯¯åˆ ï¼‰ï¼ŒæŠ¥é”™æç¤ºâ€œæ–‡æ¡£æ ¼å¼æŸåâ€ï¼Œä¿æŠ¤æ•°æ®åº“ä¸è¢«æ±¡æŸ“ã€‚
* **å®‰å…¨æ€§ï¼š** API Key é€šè¿‡ `.env` ç®¡ç†ï¼Œä¸ç¡¬ç¼–ç ã€‚

---

## 6. å¼€å‘è·¯çº¿å›¾ (Next Steps)

å»ºè®®æŒ‰æ­¤é¡ºåºå¼€å‘ï¼Œä»¥æœ€å¿«é€Ÿåº¦éªŒè¯ MVPï¼š

1. **Step 1 (DB & State):** å»ºç«‹ SQLite è¡¨ç»“æ„ï¼Œå†™å¥½â€œçŠ¶æ€æ£€æŸ¥â€å‡½æ•°ã€‚
2. **Step 2 (Runner):** è·‘é€š `yt-dlp -> WhisperX -> DB` çš„æµç¨‹ï¼Œç¡®ä¿æ–­ç‚¹èƒ½å­˜èƒ½å–ã€‚
3. **Step 3 (Obsidian Gen):** å†™ `render.py`ï¼ŒæŠŠ DB æ•°æ®å˜æˆæ¼‚äº®çš„ Markdown è¡¨æ ¼ã€‚
4. **Step 4 (Publisher):** å†™ `parse.py`ï¼Œå®ç°ä» Markdown è¯»å›æ•°æ®å¹¶ä¸Šä¼ é£ä¹¦ã€‚
